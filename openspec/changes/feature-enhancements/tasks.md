# Implementation Tasks

## 1. 后端输出流式转发
- [x] 1.1 在 `src/config.mjs` 中添加 `backendOutput` 参数
- [x] 1.2 添加 `--backend-output` 命令行参数解析
- [x] 1.3 在 `src/executor.mjs` 中实现输出转发逻辑
- [x] 1.4 修改 stdio 配置以支持实时转发
- [x] 1.5 实现 ANSI 颜色代码保留
- [x] 1.6 添加输出分隔符（区分进度信息和后端输出）
- [ ] 1.7 测试各后端的输出转发功能

## 2. 错误处理增强
- [x] 2.1 创建 `src/errors.mjs` 错误处理模块
- [x] 2.2 定义错误分类和错误码枚举
- [x] 2.3 实现 `formatError()` 函数（结构化错误输出）
- [x] 2.4 为常见错误添加解决建议映射
- [x] 2.5 实现 logger 初始化失败的 fallback 逻辑
- [x] 2.6 改进 `src/main.mjs` 中的错误捕获和显示
- [x] 2.7 添加错误堆栈的可选显示（--verbose 模式）

## 3. 配置验证
- [x] 3.1 在 `src/config.mjs` 中实现 `validateConfig()` 函数
- [x] 3.2 添加 timeout 参数校验（> 0 且 <= 最大值）
- [x] 3.3 实现 backend 可用性检查（命令是否存在）
- [x] 3.4 添加文件路径验证（promptFile 等）
- [x] 3.5 实现权限检查（workDir 可写性）
- [x] 3.6 提供友好的配置错误提示
- [x] 3.7 在 main.mjs 中调用配置验证

## 4. 帮助信息优化
- [x] 4.1 重构 `src/main.mjs` 中的帮助文本
- [x] 4.2 添加参数分组（必需参数 vs 可选参数）
- [x] 4.3 添加常见用法示例（至少3个）
- [x] 4.4 添加文档链接和快速入门指南
- [x] 4.5 改进参数描述的可读性
- [x] 4.6 添加环境变量说明
- [x] 4.7 测试帮助信息的显示效果

## 5. 错误处理测试
- [x] 5.1 创建 `test/error-handling.test.mjs`
- [x] 5.2 测试 backend not found 错误
- [x] 5.3 测试 timeout 错误
- [x] 5.4 测试无效参数错误
- [x] 5.5 测试文件不存在错误
- [x] 5.6 测试权限错误
- [x] 5.7 验证错误信息包含解决建议

## 6. 配置验证测试
- [x] 6.1 创建 `test/config-validation.test.mjs`
- [x] 6.2 测试 timeout 参数验证
- [x] 6.3 测试 backend 可用性检查
- [x] 6.4 测试文件路径验证
- [x] 6.5 测试权限验证
- [x] 6.6 验证友好的错误提示

## 7. 端到端验证
- [x] 7.1 测试 --backend-output 功能（各后端）
- [x] 7.2 测试错误场景的用户体验
- [x] 7.3 测试配置验证的实际效果
- [x] 7.4 验证帮助信息的完整性
- [x] 7.5 确认向后兼容性

## 8. 文档更新
- [x] 8.1 更新 README.md 添加新参数说明
- [x] 8.2 更新 CLAUDE.md 记录新模块
- [x] 8.3 更新 CHANGELOG.md 记录变更

## Estimated Time
- 总工时：约8小时
- 预计工期：2-3天（业余时间）

## Definition of Done
- [x] 所有测试用例通过
- [x] --backend-output 功能正常工作
- [x] 错误信息清晰且包含解决建议
- [x] 配置验证在启动前捕获错误
- [x] 帮助信息友好易懂
- [x] 向后兼容性验证通过
- [x] 文档更新完整
